// Prisma Schema - Payment Service
// Database: cropfresh_payment
// Purpose: Transactions, escrow, splits

generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

// Transaction Model
model Transaction {
  id               Int             @id @default(autoincrement())
  orderId          Int             @map("order_id")
  type             TransactionType
  amount           Decimal         @db.Decimal(10, 2)
  status           PaymentStatus   @default(PENDING)
  upiTransactionId String?         @map("upi_transaction_id") @db.VarChar(100)
  createdAt        DateTime        @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt        DateTime        @updatedAt @map("updated_at") @db.Timestamptz(6)
  deletedAt        DateTime?       @map("deleted_at") @db.Timestamptz(6)

  splits PaymentSplit[]

  @@map("transactions")
}

// PaymentSplit Model
model PaymentSplit {
  id            Int           @id @default(autoincrement())
  transactionId Int           @map("transaction_id")
  recipientType RecipientType
  recipientId   Int           @map("recipient_id")
  amount        Decimal       @db.Decimal(10, 2)
  status        PaymentStatus @default(PENDING)
  createdAt     DateTime      @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt     DateTime      @updatedAt @map("updated_at") @db.Timestamptz(6)

  transaction Transaction @relation(fields: [transactionId], references: [id])

  @@map("payment_splits")
}

enum TransactionType {
  ESCROW_HOLD
  FARMER_PAYMENT
  HAULER_PAYMENT
  PLATFORM_FEE
  REFUND
}

enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
  REFUNDED
}

enum RecipientType {
  FARMER
  HAULER
  PLATFORM
  BUYER
}
